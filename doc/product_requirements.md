# Divisadero PRD

[Problem Statement](https://docs.google.com/presentation/d/10Cvj5f86F6U4uFBxkt8hhEa9CJPfor8fTCe1KP27KME/edit?usp=sharing)

### Definitionsto

* **Superuser:** a Divisadero representative (with unlimited privileges)  
* **User:** an authenticated (customer) user  
* **Visitor:** a unauthenticated user  
* **Authenticated:** logged in to a user


## User Stories

These stories are the expectations for functionality from the user’s perspective.

| Category | Story | Backend Status | Frontend Status | Notes |
| :---- | :---- | :---- | :---- | :---- |
| Auth | Superuser can create an org |  |  |  |
| Auth | Superuser can invite a user to an org via email or link |  |  |  |
| Auth | User can accept their invite |  |  |  |
| Auth | User can log into their account |  |  |  |
| Browse | User can see a list of categories, brands, and brands within a category |  |  |  |
| View | User can view a category and all of the info about that category |  |  | Include “trending” ads section within that category  |
| View | User can view a brand and all of it’s info and ads |  |  | A brand might have new details as it gets enriched, so we need to pull in the latest enrichment.  |
| View | User can view an ad in detail |  |  | An ad might have new details as it gets enriched, so we need to pull in the latest enrichment,  |
| Search | User can perform a search with various filters (including semantic search) and see the matched ads |  |  |  |
| Sharing | User can share any url as a deep link for another user (especially a for a search) |  |  |  |
| Collections | User can create collections and add ads to those collections  |  |  |  |
| Admin | Superuser can add a new brand and configuration |  |  |  |
| Admin | Superuser (via API) can add new ads (and media) |  |  |  |
| Admin | Superuser (via API) can add new enrichments for brands |  |  |  |
| Admin | Superuser (via API) can add new enrichments for ads (and media files) |  |  |  |

## 

## Entities & Actions

This outlines the data model and endpoints. 

### **Organizations**

Organization is 1:1 with a customer / team and can have multiple users / seats.   
Do *not* worry about enforcing seats at this stage.   
Only Divisadero superuser can create orgs at this stage. 

| Action | Method | Endpoint | Payload | Response | Authentication? |  Authorization | Details | Backend Status | Frontend Status |
| :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| **Create Organization** | `POST` | `/org` | `org_name org_slug` | `org_id` | ☑️ | Superuser | For now only Divisadero reps can create orgs |  |  |
| **View Organization** | `GET` | `/org/<org_slug>` |  | `org.*` | ☑️ | Superuser, User | Should include a list of users and other info. |  |  |

#### `orgs` table

| PK | Column | Type | Autogenerated | Unique | Nullable | Foreign Key | Example | Description |
| :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| ☑️ | `org_id` | Bigint | ☑️ | ☑️ |  |  | `12345` |  |
|  | `org_slug` | String |  | ☑️ |  |  | `“moonbrew”` |  |
|  | `created_at` | Timestamp | ☑️ |  |  |  | `2025-12-13 12:05:10` |  |
|  | `updated_at` | Timestamp | ☑️ |  |  |  | `2025-12-15 10:12:37` |  |

### **Users**

A user can only belong to a single org, unless they are a superuser.   
We are not allowing users to sign up themselves at this stage. Instead Divisadero will create the initial user for the org and allow the users to invite other users.   
Ideally make the login as smooth as possible with Google or email links via Supabase.   
Also do not worry about logging out at this stage.   
For now a user can only belong to a single org. 

Note all of this is expected to be dependent on the Supabase user management. [See these docs for example](https://supabase.com/docs/reference/javascript/auth-admin-inviteuserbyemail).  

| Action | Method | Endpoint | Payload | Response | Authentication? |  Authorization | Details | Backend Status | Frontend Status |
| :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| **Signup** | DO NOT IMPLEMENT |  |  |  |  |  |  |  |  |
| **Login** | `POST` | `/login` | `email <credentials>` | `cookie?` |  | Superuser, User | Should include a list of users and other info. |  |  |
| **Logout** | DO NOT IMPLEMENT |  |  |  |  |  |  |  |  |
| **Invite User** | `POST` | `/org/<org_slug>/invite` | `email, current_user, org_id` | `user_id?` | ☑️ | Superuser, User |  |  |  |
| **Accept Invite** | `POST` | `/accept` |  |  |  |  |  |  |  |
| **View User** | `GET` | `/user/<user_id>` |  | `user.*` | ☑️ | Superuser, User |  |  |  |

#### `users` table

| PK | Column | Type | Autogenerated | Unique | Nullable | Foreign Key | Example | Description |
| :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| ☑️ | `user_id` | Bigint | ☑️ | ☑️ |  |  | `12345` |  |
|  | `is_superuser` | Bool |  |  |  |  | `false` |  |
|  | `email` | String |  | ☑️ |  |  | `“alicia@moonbrew.co”` |  |
|  | `org_id` | Bigint |  |  | ☑️ | `orgs.id` | `12345` |  |
|  | `is_activated` | Bool |  |  |  |  | `true` | Is the user activated / has logged in once / accepted the invite link? |
|  | `created_at` | Timestamp | ☑️ |  |  |  | `2025-12-13 12:05:10` |  |
|  | `updated_at` | Timestamp | ☑️ |  |  |  | `2025-12-15 10:12:37` |  |

### **Analytics**

We want to be able to track user behavior to understand onboarding, adoption, usage, and retention at the org and the user level. This will help us understand how different roles interact with the product and where they might be getting stuck. The ultimate goal is to have the data to learn from our customers and make sure they are finding success.   
For now, we will be doing the analytics in-house instead of using a tool like Segment, Google Analytics or something else. 

Ultimately, we are tracking individual pageviews and the context associated with that pageview. 

| Action | Method | Endpoint | Payload | Response | Authentication? |  Authorization | Details | Backend Status | Frontend Status |
| :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| **Pageview** | POST | `/analytics/pageview` | `current_user current_page` | `pageview_id` | ☑️ | Superuser, User | Needs to be implemented on all pages |  |  |
| **Pageview** | GET | `/analytics/pageview/<event_id>` |  | `pageview.*` | ☑️ | Superuser |  |  |  |

#### `analytics` table

| PK | Column | Type | Autogenerated | Unique | Nullable | Foreign Key | Example | Description |
| :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| ☑️ | `event_id` | Bigint | ☑️ | ☑️ |  |  | `1234567` |  |
|  | `created_at` | Timestamp | ☑️ |  |  |  | `2025-12-13 12:05:10` |  |
|  | `user_id` | Bigint |  |  |  | `users.id` | `12345` |  |
|  | `url` | String |  |  |  |  | `/brands/moonbrew` | Ideally we’d also like to capture the specific ad the person viewed that might be part of the url (eg. `/brands/moonbrew?ad=123)` |

